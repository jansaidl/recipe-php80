zerops:
  - setup: app
    build:
      base: ubuntu@24.04
      envVariables:
        Version: "8.0"
      prepareCommands:
        - cd /build/source/; sudo -E zsc envReplace image/root /root
        - cd /build/source/; sudo -E ./install.sh build
      addToRunPrepare:
        - ./image
        - ./install.sh
      deployFiles:
        - ./src/~
        - ./image
    run:
      base: ubuntu@24.04
      envVariables:
        Version: "8.0"
        DocumentRoot: "/var/www/public"
      prepareCommands:
        - cd /home/zerops; sudo -E zsc envReplace image/root /root
        - cd /home/zerops; sudo -E ./install.sh runtime
        - cd /home/zerops; sudo -E zsc envReplace image/etc /etc
        - touch /home/zerops/x
      ports:
        - port: 80
          httpSupport: true
      startCommands:
        - command: sudo -E /usr/sbin/php-fpm8.0 --nodaemonize --fpm-config /etc/php/8.0/fpm/php-fpm.conf
          name: php80
          initCommands:
            - cd /var/www; sudo -E zsc envReplace image/etc /etc
            - sudo timedatectl set-timezone Europe/Prague
            - sudo systemctl restart nginx.service

